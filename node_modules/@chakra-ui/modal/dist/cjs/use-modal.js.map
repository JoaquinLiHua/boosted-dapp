{"version":3,"sources":["../../src/use-modal.ts"],"names":["useModal","props","isOpen","onClose","id","closeOnOverlayClick","closeOnEsc","useInert","onOverlayClickProp","onOverlayClick","onEsc","autoFocus","trapFocus","initialFocusRef","finalFocusRef","returnFocusOnClose","blockScrollOnMount","allowPinchZoom","dialogRef","overlayRef","dialogId","headerId","bodyId","useAriaHidden","mouseDownTarget","onMouseDown","event","current","target","onKeyDown","key","stopPropagation","manager","isTopModal","headerMounted","setHeaderMounted","bodyMounted","setBodyMounted","getContentProps","ref","role","tabIndex","undefined","onClick","getOverlayProps","shouldHide","undo"],"mappings":"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","sourcesContent":["import { useIds } from \"@chakra-ui/hooks\"\nimport { callAllHandlers, Dict, mergeRefs } from \"@chakra-ui/utils\"\nimport { Undo, hideOthers } from \"aria-hidden\"\nimport {\n  KeyboardEvent,\n  useCallback,\n  Ref,\n  RefObject,\n  MouseEvent,\n  useRef,\n  useEffect,\n  useState,\n} from \"react\"\nimport { manager, useModalManager } from \"./modal-manager\"\n\nexport interface UseModalProps {\n  /**\n   * If `true`, the modal when be opened.\n   */\n  isOpen: boolean\n  /**\n   * The `id` of the modal\n   */\n  id?: string\n  /**\n   * Callback invoked to close the modal.\n   */\n  onClose(): void\n  /**\n   * If `true`, the modal will close when the overlay is clicked\n   * @default true\n   */\n  closeOnOverlayClick?: boolean\n  /**\n   * If `true`, the modal will close when the `Esc` key is pressed\n   * @default true\n   */\n  closeOnEsc?: boolean\n  /**\n   * Callback fired when the overlay is clicked.\n   */\n  onOverlayClick?(): void\n  /**\n   * Callback fired when the escape key is pressed and focus is within modal\n   */\n  onEsc?(): void\n  /**\n   * A11y: If `true`, the siblings of the `modal` will have `aria-hidden`\n   * set to `true` so that screen readers can only see the `modal`.\n   *\n   * This is commonly known as making the other elements **inert**\n   *\n   *  @default true\n   */\n  useInert?: boolean\n  /**\n   * If `false`, focus lock will be disabled completely.\n   *\n   * This is useful in situations where you still need to interact with\n   * other surrounding elements.\n   *\n   * ðŸš¨Warning: We don't recommend doing this because it hurts the\n   * accessbility of the modal, based on WAI-ARIA specifications.\n   *\n   * @default true\n   */\n  trapFocus?: boolean\n  /**\n   * If `true`, the modal will autofocus the first enabled and interative\n   * element within the `ModalContent`\n   *\n   * @default true\n   */\n  autoFocus?: boolean\n  /**\n   * The `ref` of element to receive focus when the modal opens.\n   */\n  initialFocusRef?: RefObject<HTMLElement>\n  /**\n   * The `ref` of element to receive focus when the modal closes.\n   */\n  finalFocusRef?: RefObject<HTMLElement>\n  /**\n   * If `true`, the modal will return focus to the element that triggered it when it closes.\n   * @default true\n   */\n  returnFocusOnClose?: boolean\n  /**\n   * If `true`, scrolling will be disabled on the `body` when the modal opens.\n   *  @default true\n   */\n  blockScrollOnMount?: boolean\n  /**\n   * Handle zoom/pinch gestures on iOS devices when scroll locking is enabled.\n   * Defaults to `false`.\n   */\n  allowPinchZoom?: boolean\n}\n\n/**\n * Modal hook that manages all the logic for the modal dialog widget\n * and returns prop getters, state and actions.\n *\n * @param props\n */\nexport function useModal(props: UseModalProps) {\n  const {\n    isOpen,\n    onClose,\n    id,\n    closeOnOverlayClick = true,\n    closeOnEsc = true,\n    useInert = true,\n    onOverlayClick: onOverlayClickProp,\n    onEsc,\n    autoFocus,\n    trapFocus,\n    initialFocusRef,\n    finalFocusRef,\n    returnFocusOnClose,\n    blockScrollOnMount,\n    allowPinchZoom,\n  } = props\n\n  const dialogRef = useRef<HTMLElement>(null)\n  const overlayRef = useRef<HTMLElement>(null)\n\n  const [dialogId, headerId, bodyId] = useIds(\n    id,\n    `chakra-modal`,\n    `chakra-modal--header`,\n    `chakra-modal--body`,\n  )\n\n  /**\n   * Hook used to polyfill `aria-modal` for older browsers.\n   * It uses `aria-hidden` to all other nodes.\n   *\n   * @see https://developer.paciellogroup.com/blog/2018/06/the-current-state-of-modal-dialog-accessibility/\n   */\n  useAriaHidden(dialogRef, isOpen && useInert)\n  /**\n   * Hook use to manage multiple or nested modals\n   */\n  useModalManager(dialogRef, isOpen)\n\n  const mouseDownTarget = useRef<EventTarget | null>(null)\n\n  const onMouseDown = useCallback((event: MouseEvent) => {\n    mouseDownTarget.current = event.target\n  }, [])\n\n  const onKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.key === \"Escape\") {\n        event.stopPropagation()\n\n        if (closeOnEsc) {\n          onClose?.()\n        }\n\n        onEsc?.()\n      }\n    },\n    [closeOnEsc, onClose, onEsc],\n  )\n\n  const onOverlayClick = useCallback(\n    (event: MouseEvent) => {\n      event.stopPropagation()\n      /**\n       * Make sure the event starts and ends on the same DOM element.\n       *\n       * This is used to prevent the modal from closing when you\n       * start dragging from the content, and release drag outside the content.\n       *\n       * We prevent this because it's technically not a considered \"click outside\"\n       */\n      if (mouseDownTarget.current !== event.target) return\n\n      /**\n       * When you click on the overlay, we want to remove only the topmost modal\n       */\n      if (manager.isTopModal(dialogRef)) {\n        if (closeOnOverlayClick) {\n          onClose?.()\n        }\n        onOverlayClickProp?.()\n      }\n    },\n    [onClose, closeOnOverlayClick, onOverlayClickProp],\n  )\n\n  const [headerMounted, setHeaderMounted] = useState(false)\n  const [bodyMounted, setBodyMounted] = useState(false)\n\n  const getContentProps = useCallback(\n    (props: Dict = {}, ref: Ref<any>) => ({\n      ...props,\n      ref: mergeRefs(ref, dialogRef),\n      id: dialogId,\n      role: props.role || \"dialog\",\n      tabIndex: -1,\n      \"aria-modal\": true,\n      \"aria-labelledby\": headerMounted ? headerId : undefined,\n      \"aria-describedby\": bodyMounted ? bodyId : undefined,\n      onClick: callAllHandlers(props.onClick, (event: MouseEvent) =>\n        event.stopPropagation(),\n      ),\n    }),\n    [bodyId, bodyMounted, dialogId, headerId, headerMounted],\n  )\n\n  const getOverlayProps = useCallback(\n    (props: Dict = {}, ref: Ref<any>) => ({\n      ...props,\n      ref: mergeRefs(ref, overlayRef),\n      onClick: callAllHandlers(props.onClick, onOverlayClick),\n      onKeyDown: callAllHandlers(props.onKeyDown, onKeyDown),\n      onMouseDown: callAllHandlers(props.onMouseDown, onMouseDown),\n    }),\n    [onKeyDown, onMouseDown, onOverlayClick],\n  )\n\n  return {\n    isOpen,\n    onClose,\n    autoFocus,\n    trapFocus,\n    initialFocusRef,\n    finalFocusRef,\n    returnFocusOnClose,\n    headerId,\n    bodyId,\n    setBodyMounted,\n    setHeaderMounted,\n    dialogRef,\n    overlayRef,\n    blockScrollOnMount,\n    allowPinchZoom,\n    getContentProps,\n    getOverlayProps,\n  }\n}\n\nexport type UseModalReturn = ReturnType<typeof useModal>\n\n/**\n * Modal hook to polyfill `aria-modal`.\n *\n * It applies `aria-hidden` to elements behind the modal\n * to indicate that they're `inert`.\n *\n * @param ref React ref of the node\n * @param shouldHide whether `aria-hidden` should be applied\n */\nexport function useAriaHidden(\n  ref: RefObject<HTMLElement>,\n  shouldHide: boolean,\n) {\n  useEffect(() => {\n    if (!ref.current) return\n\n    let undo: Undo | null = null\n\n    if (shouldHide && ref.current) {\n      undo = hideOthers(ref.current)\n    }\n\n    return () => {\n      if (shouldHide) {\n        undo?.()\n      }\n    }\n  }, [shouldHide, ref])\n}\n"],"file":"use-modal.js"}