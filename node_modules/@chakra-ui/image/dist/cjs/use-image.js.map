{"version":3,"sources":["../../src/use-image.ts"],"names":["useImage","props","src","srcSet","onLoad","onError","crossOrigin","sizes","ignoreFallback","ignore","isBrowser","status","setStatus","imageRef","load","flush","img","Image","srcset","onload","event","onerror","error","current"],"mappings":"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","sourcesContent":["import { useSafeLayoutEffect } from \"@chakra-ui/hooks\"\nimport { isBrowser } from \"@chakra-ui/utils\"\nimport {\n  useState,\n  useRef,\n  useEffect,\n  useCallback,\n  ImgHTMLAttributes,\n} from \"react\"\n\nexport type UseImageProps = {\n  /**\n   * The image `src` attribute\n   */\n  src?: string\n  /**\n   * The image `srcset` attribute\n   */\n  srcSet?: string\n  /**\n   * The image `sizes` attribute\n   */\n  sizes?: string\n  /**\n   * A callback for when the image `src` has been loaded\n   */\n  onLoad?(event: Event): void\n  /**\n   * A callback for when there was an error loading the image `src`\n   */\n  onError?(error: string | Event): void\n  /**\n   * If `true`, opt out of the `fallbackSrc` logic and use as `img`\n   */\n  ignoreFallback?: boolean\n  /**\n   * The key used to set the crossOrigin on the HTMLImageElement into which the image will be loaded.\n   * This tells the browser to request cross-origin access when trying to download the image data.\n   */\n  crossOrigin?: ImgHTMLAttributes<any>[\"crossOrigin\"]\n}\n\ntype Status = \"loading\" | \"failed\" | \"pending\" | \"loaded\"\n\n/**\n * React hook that loads an image in the browser,\n * and let's us know the `status` so we can show image\n * fallback if it's still `pending`\n *\n * @returns the status of the image loading progress\n *\n * @example\n *\n * ```jsx\n * function App(){\n *   const status = useImage({ src: \"image.png\" })\n *   return status === \"loaded\" ? <img src=\"image.png\" /> : <Placeholder />\n * }\n * ```\n */\nexport function useImage(props: UseImageProps) {\n  const {\n    src,\n    srcSet,\n    onLoad,\n    onError,\n    crossOrigin,\n    sizes,\n    ignoreFallback,\n  } = props\n\n  /**\n   * Ignore this fallback complete in an SSR environment\n   * so the `src` doesn't get missing in SSR.\n   */\n  const ignore = ignoreFallback || !isBrowser\n\n  const [status, setStatus] = useState<Status>(() => {\n    return src ? \"loading\" : \"pending\"\n  })\n\n  useEffect(() => {\n    setStatus(src ? \"loading\" : \"pending\")\n  }, [src])\n\n  const imageRef = useRef<HTMLImageElement | null>()\n\n  const load = useCallback(() => {\n    if (!src) return\n\n    flush()\n\n    const img = new Image()\n\n    img.src = src\n\n    if (crossOrigin) {\n      img.crossOrigin = crossOrigin\n    }\n\n    if (srcSet) {\n      img.srcset = srcSet\n    }\n\n    if (sizes) {\n      img.sizes = sizes\n    }\n\n    img.onload = (event) => {\n      flush()\n      setStatus(\"loaded\")\n      onLoad?.(event)\n    }\n    img.onerror = (error) => {\n      flush()\n      setStatus(\"failed\")\n      onError?.(error)\n    }\n\n    imageRef.current = img\n  }, [src, crossOrigin, srcSet, sizes, onLoad, onError])\n\n  const flush = () => {\n    if (imageRef.current) {\n      imageRef.current.onload = null\n      imageRef.current.onerror = null\n      imageRef.current = null\n    }\n  }\n\n  useSafeLayoutEffect(() => {\n    /**\n     * If user opts out of the fallback/placeholder\n     * logic, let's bail out.\n     */\n    if (ignore) return\n\n    if (status === \"loading\") {\n      load()\n    }\n    return () => {\n      flush()\n    }\n  }, [status, load, ignore])\n\n  /**\n   * If user opts out of the fallback/placeholder\n   * logic, let's just return 'loaded'\n   */\n  return ignore ? \"loaded\" : status\n}\n\nexport type UseImageReturn = ReturnType<typeof useImage>\n"],"file":"use-image.js"}