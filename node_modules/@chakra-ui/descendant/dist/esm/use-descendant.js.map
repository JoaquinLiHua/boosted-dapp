{"version":3,"sources":["../../src/use-descendant.ts"],"names":["useCallback","useMemo","useState","useSafeLayoutEffect","useForceUpdate","useDescendant","props","context","element","index","indexProp","disabled","focusable","rest","forceUpdate","register","unregister","descendants","Object","values","findIndex","descendant","useDescendants","setDescendants","prevDescendants","find","item","Boolean","compareDocumentPosition","Node","DOCUMENT_POSITION_PRECEDING","newItem","slice","filter"],"mappings":"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","sourcesContent":["import { useCallback, useMemo, useState } from \"react\"\nimport { useSafeLayoutEffect, useForceUpdate } from \"@chakra-ui/hooks\"\n\nexport type Descendant<T extends HTMLElement, P = {}> = P & {\n  element: T | null\n  index?: number\n  disabled?: boolean\n  focusable?: boolean\n}\n\nexport interface DescendantContext<T extends HTMLElement, P = {}> {\n  descendants: Descendant<T, P>[]\n  register: (descendant: Descendant<T, P>) => void\n  unregister: (element: T) => void\n}\n\nexport type UseDescendantProps<T extends HTMLElement, P> = {\n  context: DescendantContext<T, P>\n} & Descendant<T, P>\n\nexport function useDescendant<T extends HTMLElement, P>(\n  props: UseDescendantProps<T, P>,\n) {\n  const {\n    context,\n    element,\n    index: indexProp,\n    disabled,\n    focusable,\n    ...rest\n  } = props\n\n  const forceUpdate = useForceUpdate()\n  const { register, unregister, descendants } = context\n\n  useSafeLayoutEffect(() => {\n    if (!element) {\n      forceUpdate()\n    }\n\n    /**\n     * Don't register this descendant if it's disabled and not focusable\n     */\n    if (disabled && !focusable) return\n\n    /**\n     * else, register the descendant\n     */\n    register({ element, disabled, focusable, ...rest } as any)\n\n    /**\n     * when it unmounts, unregister the descendant\n     */\n    return () => {\n      if (element) {\n        unregister(element)\n      }\n    }\n    //eslint-disable-next-line\n  }, [element, ...Object.values(rest)])\n\n  const index =\n    indexProp ??\n    descendants.findIndex((descendant) => descendant.element === element)\n\n  return index\n}\n\nexport function useDescendants<T extends HTMLElement, P>() {\n  const [descendants, setDescendants] = useState<Descendant<T, P>[]>([])\n\n  const register = useCallback(({ element, ...rest }: Descendant<T, P>) => {\n    if (!element) return\n\n    //@ts-ignore\n    setDescendants((prevDescendants) => {\n      if (prevDescendants.find((item) => item.element === element) == null) {\n        const index = prevDescendants.findIndex((item) => {\n          if (!item.element || !element) return false\n\n          return Boolean(\n            item.element.compareDocumentPosition(element) &\n              Node.DOCUMENT_POSITION_PRECEDING,\n          )\n        })\n\n        const newItem = { element, ...rest }\n\n        if (index === -1) {\n          return [...prevDescendants, newItem]\n        }\n        return [\n          ...prevDescendants.slice(0, index),\n          newItem,\n          ...prevDescendants.slice(index),\n        ]\n      }\n      return prevDescendants\n    })\n  }, [])\n\n  const unregister = useCallback((element: T) => {\n    if (!element) return\n    setDescendants((descendants) =>\n      descendants.filter((descendant) => element !== descendant.element),\n    )\n  }, [])\n\n  const context = useMemo(() => {\n    return { descendants, register, unregister }\n  }, [descendants, register, unregister])\n\n  return context\n}\n"],"file":"use-descendant.js"}